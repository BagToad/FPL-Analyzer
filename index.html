<!DOCTYPE html>
<html lang="en" ng-app="FPLAnalyzer">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="./src/styles.min.css">
	<link rel="shortcut icon" type="image/x-icon" href="./src/favicon.ico">
	<title>FPL Analyzer</title>
</head>

<body ng-controller="FPLCtrl as fpl">
	<div id="side-nav" ng-class="{'side-nav-open': fpl.sideNavOpen}">
		<header>
			<i class="material-icons" style="margin-right: 10px;">search</i>
			<input type="text" placeholder="Search" ng-model="fpl.search.name" ng-change="fpl.filter()">
		</header>
		<ul>
			<h2>Limit</h2>
			<li>
				<fpl-checkbox model="fpl.search.limit"></fpl-checkbox>
				<input type="range" ng-model="fpl.search.limitSize" min="1" max="{{ fpl.data.players.length }}" ng-disabled="!fpl.search.limit">
				&nbsp;
				<input type="text" ng-model="fpl.search.limitSize" ng-disabled="!fpl.search.limit" style="width: 50px;">
			</li>
			<h2>Columns</h2>
			<li>
				<table class="select multi" tabindex="1" style="width: 225px;">
					<thead>
						<th>Show / hide</th>
						<th><i class="material-icons">arrow_drop_down</i></th>
					</thead>
					<tbody style="display: none;">
						<tr ng-repeat="col in fpl.cols"><td>
							<label><fpl-checkbox model="col.show"></fpl-checkbox>
							<span ng-class="{accent: col.show}">{{ col.label }}</span></label>
						</td></tr>
					</tbody>
				</table>
			</li>
			<h2>Teams</h2>
			<li>
				<table class="select multi" tabindex="1" style="width: 225px;">
					<thead>
						<th>Select teams</th>
						<th><i class="material-icons">arrow_drop_down</i></th>
					</thead>
					<tbody style="display: none;">
						<tr><td>
							<label><fpl-checkbox model="fpl.search.teams.all" change="fpl.filter()"></fpl-checkbox>
							<span ng-class="{accent: fpl.search.teams.all}">All teams</span></label>
						</td></tr>
						<tr ng-repeat="team in fpl.data.teams"><td>
							<label><fpl-checkbox model="fpl.search.teams[team.id]" change="fpl.filter()"></fpl-checkbox>
							<span ng-class="{accent: search.teams[team.id]}">{{ team.name }}</span></label>
						</td></tr>
					</tbody>
				</table>
			</li>
			<h2>Positions</h2>
			<li>
				<table class="select multi" tabindex="1" style="width: 225px;">
					<thead>
						<th>Select positions</th>
						<th><i class="material-icons">arrow_drop_down</i></th>
					</thead>
					<tbody style="display: none;">
						<tr><td>
							<label><fpl-checkbox model="fpl.search.poss.all" change="fpl.filter()"></fpl-checkbox>
							<span ng-class="{accent: fpl.search.poss.all}">All positions</span></label>
						</td></tr>
						<tr ng-repeat="pos in fpl.data.element_types"><td>
							<label><fpl-checkbox model="fpl.search.poss[pos.id]" change="fpl.filter()"></fpl-checkbox>
							<span ng-class="{accent: fpl.search.poss[pos.id]}">{{ pos.plural_name }}</span></label>
						</td></tr>
					</tbody>
				</table>
			</li>
			<h2>Filters</h2>
			<li>
				<table class="select multi" tabindex="1" style="width: 225px;">
					<thead>
						<th>Show / hide</th>
						<th><i class="material-icons">arrow_drop_down</i></th>
					</thead>
					<tbody style="display: none;">
						<tr ng-repeat="filter in fpl.filters"><td>
							<label><fpl-checkbox model="filter.show"></fpl-checkbox>
							<span ng-class="{accent: filter.show}">{{ filter.label }}</span></label>
						</td></tr>
					</tbody>
				</table>
			</li>
			<div ng-repeat="filter in fpl.filters" ng-show="filter.show">
				<h2>{{ filter.label }}</h2>
				<li>
					<input type="number" ng-model="filter.low" ng-change="fpl.filter()">
					&nbsp;to&nbsp;
					<input type="number" ng-model="filter.high" ng-change="fpl.filter()">
				</li>
			</div>
		</ul>
		<footer>
			<input type="button" value="Clear filters" ng-click="fpl.resetTable(); fpl.filter()">
		</footer>
	</div>

	<div id="blur" onclick="$(this).fadeOut(200)" style="display: none;">
		<div id="popup">
			<div id="popup-header">
				<img ng-src="{{ fpl.popupPlayer.url }}">
				<div>
					<div id="popup-name">{{ fpl.popupPlayer.first_name }} {{ fpl.popupPlayer.second_name }}</div>
					<div id="popup-team">{{ fpl.data.teams[fpl.popupPlayer.team - 1].name }}</div>
					<div id="popup-pos">{{ fpl.data.element_types[fpl.popupPlayer.element_type - 1].singular_name }}</div>
				</div>
				<span id="popup-number">{{ fpl.popupPlayer.squad_number }}</span>
			</div>
			<table>
				<tr>
					<td>Points</td>
					<td>GW</td>
					<td>Form</td>
					<td>VAPM</td>
					<td>PPG</td>
				</tr>
				<tr>
					<td>{{ fpl.popupPlayer.total_points }}</td>
					<td>{{ fpl.popupPlayer.event_points }}</td>
					<td>{{ fpl.popupPlayer.form }}</td>
					<td>{{ fpl.popupPlayer.value_added_per_mil.toFixed(2) }}</td>
					<td>{{ fpl.popupPlayer.points_per_game }}</td>
				</tr>
				<tr>
					<td>Price</td>
					<td>Selected</td>
					<td>Net Transfers</td>
					<td>Cost Change</td>
					<td>Minutes</td>
				</tr>
				<tr>
					<td>£{{ fpl.popupPlayer.now_cost.toFixed(1) }}</td>
					<td>{{ fpl.popupPlayer.selected_by_percent }}%</td>
					<td>{{ fpl.popupPlayer.transfers_diff }}</td>
					<td>{{ fpl.popupPlayer.cost_change_start }}</td>
					<td>{{ fpl.popupPlayer.minutes }}</td>
				</tr>
			</table>
		</div>
	</div>

	<div id="content" ng-class="{'side-nav-open': fpl.sideNavOpen}">
		<header>
			<h1>FPL Analyzer</h1>
			<!-- <input type="button" value="Link to this report" ng-click="openURL()"> -->
			<div id="side-nav-toggle" ng-click="fpl.sideNavOpen = !fpl.sideNavOpen">
				<i ng-show="!fpl.sideNavOpen" class="material-icons">filter_list</i>
				<i ng-show="fpl.sideNavOpen" class="material-icons" ng-cloak>chevron_right</i>
			</div>
		</header>

		<main>
			<div style="display: flex; align-items: center; justify-content: flex-end; padding: 10px 0;">
				<span class="small-text" ng-cloak>Viewing <span class="accent">
					{{ fpl.search.limit && fpl.search.limitSize < fpl.filteredPlayers.length ? fpl.search.limitSize: (fpl.filteredPlayers.length || 0) }}</span>
					of {{ fpl.data.elements.length || 0 }} total players</span>
			</div>
			<div id="table-wrapper">
				<table id="table" ng-cloak>
					<thead>
						<tr>
							<th ng-click="fpl.toggleSort(col)" ng-show="col.show" ng-repeat="col in fpl.cols">
								<div ng-class="::{abbr: col.full_label}">{{ ::col.label }}
									<div class="dir">
										<i class="material-icons" ng-show="fpl.search.sort == col.field && !fpl.search.reverse">arrow_drop_up</i>
										<i class="material-icons" ng-show="fpl.search.sort == col.field && fpl.search.reverse">arrow_drop_down</i>
									</div>
									<div class="full-label">{{ ::col.full_label }}</div>
								</div></th>
						</tr>
					</thead>
					<tbody>
						<tr ng-click="fpl.showPopup(player)" ng-repeat="player in fpl.filteredPlayers | orderBy: fpl.search.sort:fpl.search.reverse | limitTo: fpl.search.limit ? fpl.search.limitSize: fpl.data.players.length">
							<td ng-show="fpl.cols[0].show">{{ ::player.web_name }}</td>
							<td ng-show="fpl.cols[1].show">{{ ::fpl.data.teams[player.team - 1].name }}</td>
							<td ng-show="fpl.cols[2].show">{{ ::fpl.data.element_types[player.element_type - 1].singular_name_short }}</td>
							<td ng-show="fpl.cols[3].show">{{ ::player.total_points }}</td>
							<td ng-show="fpl.cols[4].show">{{ ::player.event_points }}</td>
							<td ng-show="fpl.cols[5].show">{{ ::player.points_per_game }}</td>
							<td ng-show="fpl.cols[6].show">{{ ::player.value_season }}</td>
							<td ng-show="fpl.cols[7].show">{{ ::player.form }}</td>
							<td ng-show="fpl.cols[8].show">{{ ::player.value_form }}</td>
							<td ng-show="fpl.cols[9].show">£{{ ::player.now_cost.toFixed(1) }}</td>
							<td ng-show="fpl.cols[10].show">{{ ::player.value_added_per_mil.toFixed(2) }}</td>
							<td ng-show="fpl.cols[11].show">{{ ::player.minutes }}</td>
							<td ng-show="fpl.cols[12].show">{{ ::player.transfers_in }}</td>
							<td ng-show="fpl.cols[13].show">{{ ::player.transfers_out }}</td>
							<td ng-show="fpl.cols[14].show">{{ ::player.transfers_diff }}</td>
							<td ng-show="fpl.cols[15].show">{{ ::player.transfers_in_event }}</td>
							<td ng-show="fpl.cols[16].show">{{ ::player.transfers_out_event }}</td>
							<td ng-show="fpl.cols[17].show">{{ ::player.transfers_diff_event }}</td>
							<td ng-show="fpl.cols[18].show">{{ ::player.selected_by_percent }}%</td>
							<td ng-show="fpl.cols[19].show">{{ ::(player.cost_change_start / 10).toFixed(1) }}</td>
							<td ng-show="fpl.cols[20].show">{{ ::(player.cost_change_event / 10).toFixed(1) }}</td>
							<td ng-show="fpl.cols[21].show">{{ ::player.ict_index }}</td>
							<td ng-show="fpl.cols[22].show">{{ ::player.threat }}</td>
							<td ng-show="fpl.cols[23].show">{{ ::player.creativity }}</td>
							<td ng-show="fpl.cols[24].show">{{ ::player.influence }}</td>
							<td ng-show="fpl.cols[25].show">{{ ::player.bonus }}</td>
							<td ng-show="fpl.cols[26].show">{{ ::player.bps }}</td>
							<td ng-show="fpl.cols[27].show">{{ ::player.goals_scored }}</td>
							<td ng-show="fpl.cols[28].show">{{ ::player.assists }}</td>
							<td ng-show="fpl.cols[29].show">{{ ::player.clean_sheets }}</td>
							<td ng-show="fpl.cols[30].show">{{ ::player.saves }}</td>
							<td ng-show="fpl.cols[31].show">{{ ::player.goals_conceded }}</td>
							<td ng-show="fpl.cols[32].show">{{ ::player.yellow_cards }}</td>
							<td ng-show="fpl.cols[33].show">{{ ::player.red_cards }}</td>
						</tr>
					</tbody>
				</table>
				<div id="loading" ng-hide="fpl.data">Loading...</div>
			</div>
		</main>

		<footer>
			<div style="height: 200px; width: 100%; background: #eeeeee;"></div>
			<div style="height: 100px; width: 100%; background: #9e9e9e;"></div>
		</footer>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<script src="./src/fpl.module.ts"></script>
	<script src="./src/fpl.controller.ts"></script>
	<script src="./src/fpl-checkbox.component.ts"></script>
	<script src="./src/script.js"></script>
</body>

</html>
