var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,g,h){if(h.get||h.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[g]=h.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var g=0;return $jscomp.iteratorPrototype(function(){return g<b.length?{done:!1,value:b[g++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var g=b[Symbol.iterator];return g?g.call(b):$jscomp.arrayIterator(b)};
$jscomp.polyfill=function(b,g,h,f){if(g){h=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var e=b[f];e in h||(h[e]={});h=h[e]}b=b[b.length-1];f=h[b];g=g(f);g!=f&&null!=g&&$jscomp.defineProperty(h,b,{configurable:!0,writable:!0,value:g})}};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function g(){this.batch_=null}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;g.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};g.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var h=$jscomp.global.setTimeout;g.prototype.asyncExecuteFunction=function(a){h(a,0)};g.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var c=0;c<a.length;++c){var d=a[c];delete a[c];try{d()}catch(k){this.asyncThrow_(k)}}}this.batch_=null};g.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var f=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{a(c.resolve,c.reject)}catch(d){c.reject(d)}};f.prototype.createResolveAndReject_=function(){function a(a){return function(b){d||(d=!0,a.call(c,b))}}var c=this,d=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};f.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.settleSameAsPromise_(a);else{var c;a:switch(typeof a){case "object":c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};f.prototype.resolveToNonPromiseObj_=function(a){var c=void 0;try{c=a.then}catch(d){this.reject_(d);return}"function"==
typeof c?this.settleSameAsThenable_(c,a):this.fulfill_(a)};f.prototype.reject_=function(a){this.settle_(2,a)};f.prototype.fulfill_=function(a){this.settle_(1,a)};f.prototype.settle_=function(a,c){if(0!=this.state_)throw Error("Cannot settle("+a+", "+c|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=c;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,c=0;c<a.length;++c)a[c].call(),
a[c]=null;this.onSettledCallbacks_=null}};var e=new g;f.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};f.prototype.settleSameAsThenable_=function(a,c){var d=this.createResolveAndReject_();try{a.call(c,d.resolve,d.reject)}catch(k){d.reject(k)}};f.prototype.then=function(a,c){function d(a,c){return"function"==typeof a?function(c){try{b(a(c))}catch(q){e(q)}}:c}var b,e,g=new f(function(a,c){b=a;e=c});this.callWhenSettled_(d(a,b),
d(c,e));return g};f.prototype["catch"]=function(a){return this.then(void 0,a)};f.prototype.callWhenSettled_=function(a,c){function d(){switch(b.state_){case 1:a(b.result_);break;case 2:c(b.result_);break;default:throw Error("Unexpected state: "+b.state_);}}var b=this;null==this.onSettledCallbacks_?e.asyncExecute(d):this.onSettledCallbacks_.push(function(){e.asyncExecute(d)})};f.resolve=function(a){return a instanceof f?a:new f(function(c,d){c(a)})};f.reject=function(a){return new f(function(c,d){d(a)})};
f.race=function(a){return new f(function(c,d){for(var b=$jscomp.makeIterator(a),e=b.next();!e.done;e=b.next())f.resolve(e.value).callWhenSettled_(c,d)})};f.all=function(a){var c=$jscomp.makeIterator(a),b=c.next();return b.done?f.resolve([]):new f(function(a,d){function e(c){return function(b){g[c]=b;k--;0==k&&a(g)}}var g=[],k=0;do g.push(void 0),k++,f.resolve(b.value).callWhenSettled_(e(g.length-1),d),b=c.next();while(!b.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(f.$jscomp$new$AsyncExecutor=function(){return new g});
return f},"es6-impl","es3");
var trelloReports=angular.module("trelloReports",[]).controller("ReportsCtrl",["$scope","$window",function(b,g){b.getDate=function(b){return b?new Date(b):new Date};b.getList=function(b){return"dates['"+b+"']"};b.avgDays=function(b,e){return Math.round(e/(864E4*b))/10||0};b.formatDate=function(b,e){if(!b)return null;var a=new Date(b);return a.getMonth()+1+"-"+a.getDate()+"-"+a.getFullYear()+(e?" at "+a.getHours()+":"+((10>a.getMinutes()?"0":"")+a.getMinutes()):"")};b.exportLaunchToCustomer=function(){var f=
"Launch to Waiting for Customer "+b.formatDate(Date.now())+".csv",e=[["Name","Uses","Cards from Launch to Waiting","Launch to Waiting for Customer Average"]],a=b.stats.labels,c;for(c in a)a.hasOwnProperty(c)&&e.push([a[c].name,a[c].uses,a[c].launchToWaitingCount,b.avgDays(a[c].launchToWaitingCount,a[c].launchToWaitingSum)]);exportToCSV(f,e)};b.resetSearch=function(){b.search={sort:"name",limit:!0,limitSize:50,lists:{},allLabels:!0,labels:{},allMembers:!0,members:{},checkItemsUnit:"percent",acctMgrCheckItemsUnit:"percent"}};
b.openURL=function(){var f=function(b){return b?encodeURIComponent(JSON.stringify(b)):""};g.open("./index.html?search="+f(b.search)+"&sort="+f($("#sort-text").text())+"&calendar="+f(b.calendar)+"&table="+f(b.table))};b.getParams=function(){var b=window.location.href.split("/index.html")[1];return(/^[?#]/.test(b)?b.slice(1):b).split("&").reduce(function(b,a){var c=$jscomp.makeIterator(a.split("=")),d=c.next().value,c=c.next().value;b[d]=c?decodeURIComponent(c.replace(/\+/g," ")):"";return b},{})};
b.getBoard=function(){$("#boardUpdated").hide().next().show();(new Promise(function(b){loadBoard(b)})).then(function(f){f?(b.board=f,b.filteredCards=f.cards,b.$digest(),b.filter(),b.$digest(),localStorage.setItem("board",JSON.stringify(f)),$("#boardUpdated").show().next().hide()):console.log("got error")})};b.getStats=function(){var f=b.board.pluginMap,e=b.board.labelsMap,a=[],c={completed:{count:0,onTimeCount:0,onTimeSum:0,lateCount:0,lateSum:0},pastDue:0,checkItemsPercentSum:0,checkItemsPercentAvg:0,
acctMgrCheckItemsPercentSum:0,labels:{all:{uses:0,name:"All",launchToWaitingCount:0,launchToWaitingSum:0},none:{uses:0,name:"None",launchToWaitingCount:0,launchToWaitingSum:0}},lists:{},members:{}};b.filteredCards.forEach(function(d){b.calendar.due&&d.due&&a.push({title:d.name,start:new Date(d.due),url:d.url,className:"red"});b.calendar.parts&&d.dates&&d.dates[f.parts]&&a.push({title:d.name,start:new Date(d.dates[f.parts]),url:d.url,className:"purple"});b.calendar.tool&&d.dates&&d.dates[f.tool]&&
a.push({title:d.name,start:new Date(d.dates[f.tool]),url:d.url,className:"blue"});b.calendar.dev&&d.dates&&d.dates[f.dev]&&a.push({title:d.name,start:new Date(d.dates[f.dev]),url:d.url,className:"sky"});b.calendar.ppap&&d.dates&&d.dates[f.ppap]&&a.push({title:d.name,start:new Date(d.dates[f.ppap]),url:d.url,className:"green"});b.calendar.sample&&d.dates&&d.dates[f.sample]&&a.push({title:d.name,start:new Date(d.dates[f.sample]),url:d.url,className:"yellow"});if(d.dueComplete&&(c.completed.count++,
d.due&&d.dates[f.parts])){var g=new Date(d.due),h=new Date(d.dates[f.parts]);g<h?(c.completed.lateCount++,c.completed.lateSum+=h-g):(c.completed.onTimeCount++,c.completed.onTimeSum+=g-h)}c.checkItemsPercentSum+=d.badges.checkItemsPercent||100;c.acctMgrCheckItemsPercentSum+=d.badges.acctMgrCheckItemsPercent;d.due&&!d.dueComplete&&new Date(d.due)<new Date&&c.pastDue++;c.labels.all.uses++;0===d.idLabels.length?c.labels.none.uses++:d.idLabels.forEach(function(a){c.labels[a]||(c.labels[a]={uses:0,name:e[a].name,
launchToWaitingCount:0,launchToWaitingSum:0});c.labels[a].uses++});for(var m,l,p,g=d.actions.length-1;0<=g;g--){var h=d.actions[g].data.listBefore,n=d.actions[g].data.listAfter;n&&(p&&(c.lists[h.id]||(c.lists[h.id]={name:h.name,sum:0,count:0}),c.lists[h.id].count++,c.lists[h.id].sum+=new Date(d.actions[g].date)-new Date(p.date)),p={id:n.id,date:d.actions[g].date},"Launch"===n.name&&(m=new Date(d.actions[g].date)),"Waiting for Customer Approval"===n.name&&(l=new Date(d.actions[g].date)))}m&&l&&m<l&&
(c.labels.all.launchToWaitingCount++,c.labels.all.launchToWaitingSum+=l-m,0===d.idLabels.length?(c.labels.none.launchToWaitingCount++,c.labels.none.launchToWaitingSum+=l-m):d.idLabels.forEach(function(a){c.labels[a].launchToWaitingCount++;c.labels[a].launchToWaitingSum+=l-m}));d.idMembers.forEach(function(a){c.members[a]?c.members[a].count++:c.members[a]={count:1}})});c.checkItemsPercentAvg=Math.round(10*c.checkItemsPercentSum/b.filteredCards.length)/10;c.acctMgrCheckItemsPercentAvg=Math.round(10*
c.acctMgrCheckItemsPercentSum/b.filteredCards.length)/10;b.stats=c;$("#fullcalendar").fullCalendar("removeEventSources");$("#fullcalendar").fullCalendar("addEventSource",a)};b.filter=function(){var f=[];b.board.cards.forEach(function(e){var a=b.search,c=b.board.pluginMap,d=!0;a.name&&-1===e.name.toLowerCase().indexOf(a.name.toLowerCase())&&(d=!1);a.lists[e.idList]&&(d=!1);if(!a.allLabels){var g=!1;if(0===e.idLabels.length)a.labels.none&&(g=!0);else for(var h=0;h<e.idLabels.length;h++)a.labels[e.idLabels[h]]&&
(g=!0);g||(d=!1)}if(!a.allMembers){g=!1;if(0===e.idMembers.length)a.members.none&&(g=!0);else for(h=0;h<e.idMembers.length;h++)a.members[e.idMembers[h]]&&(g=!0);g||(d=!1)}a.dueComplete&&("true"===a.dueComplete&&!e.dueComplete||"false"===a.dueComplete&&e.dueComplete)&&(d=!1);a.dueStart&&(!e.due||new Date(a.dueStart)>new Date(e.due))&&(d=!1);a.dueEnd&&(!e.due||new Date(a.dueEnd)<new Date(e.due))&&(d=!1);a.partsStart&&(!e.dates||!e.dates.partsStart||new Date(a.partsStart)>new Date(e.dates[c.parts]))&&
(d=!1);a.partsEnd&&(!e.dates||!e.dates.partsEnd||new Date(a.partsEnd)<new Date(e.dates[c.parts]))&&(d=!1);a.toolStart&&(!e.dates||!e.dates.toolStart||new Date(a.toolStart)>new Date(e.dates[c.tool]))&&(d=!1);a.toolEnd&&(!e.dates||!e.dates.toolEnd||new Date(a.toolEnd)<new Date(e.dates[c.tool]))&&(d=!1);a.devStart&&(!e.dates||!e.dates.devStart||new Date(a.devStart)>new Date(e.dates[c.dev]))&&(d=!1);a.devEnd&&(!e.dates||!e.dates.devEnd||new Date(a.devEnd)<new Date(e.dates[c.dev]))&&(d=!1);a.ppapStart&&
(!e.dates||!e.dates.ppapStart||new Date(a.ppapStart)>new Date(e.dates[c.ppap]))&&(d=!1);a.ppapEnd&&(!e.dates||!e.dates.ppapEnd||new Date(a.ppapEnd)<new Date(e.dates[c.ppap]))&&(d=!1);a.sampleStart&&(!e.dates||!e.dates.sampleStart||new Date(a.sampleStart)>new Date(e.dates[c.sample]))&&(d=!1);a.sampleEnd&&(!e.dates||!e.dates.sampleEnd||new Date(a.sampleEnd)<new Date(e.dates[c.sample]))&&(d=!1);a.checkItemsStart&&("items"===a.checkItemsUnit&&a.checkItemsStart>e.badges.checkItemsChecked||"percent"===
a.checkItemsUnit&&a.checkItemsStart>e.badges.checkItemsPercent)&&(d=!1);a.checkItemsEnd&&("items"===a.checkItemsUnit&&a.checkItemsEnd<e.badges.checkItemsChecked||"percent"===a.checkItemsUnit&&a.checkItemsEnd<e.badges.checkItemsPercent)&&(d=!1);a.acctMgrCheckItemsStart&&("items"===a.acctMgrCheckItemsUnit&&a.acctMgrCheckItemsStart>e.badges.acctMgrCheckItemsChecked||"percent"===a.acctMgrCheckItemsUnit&&a.acctMgrCheckItemsStart>e.badges.acctMgrCheckItemsPercent)&&(d=!1);a.acctMgrCheckItemsEnd&&("items"===
a.acctMgrCheckItemsUnit&&a.acctMgrCheckItemsEnd<e.badges.acctMgrCheckItemsChecked||"percent"===a.acctMgrCheckItemsUnit&&a.acctMgrCheckItemsEnd<e.badges.acctMgrCheckItemsPercent)&&(d=!1);d&&f.push(e)});b.filteredCards=f;b.getStats()};$("#fullcalendar").fullCalendar({customButtons:{myMonth:{text:"Month",click:function(){$(this).addClass("fc-state-active").siblings().removeClass("fc-state-active");$("#fullcalendar").fullCalendar("option","height",null);$("#fullcalendar").fullCalendar("changeView","month")}},
myWeek:{text:"Week",click:function(){$(this).addClass("fc-state-active").siblings().removeClass("fc-state-active");$("#fullcalendar").fullCalendar("option","height",400);$("#fullcalendar").fullCalendar("changeView","basicWeek")}},myMonthList:{text:"Month List",click:function(){$(this).addClass("fc-state-active").siblings().removeClass("fc-state-active");$("#fullcalendar").fullCalendar("option","height",800);$("#fullcalendar").fullCalendar("changeView","listMonth")}},myWeekList:{text:"Week List",click:function(){$(this).addClass("fc-state-active").siblings().removeClass("fc-state-active");
$("#fullcalendar").fullCalendar("option","height",800);$("#fullcalendar").fullCalendar("changeView","listWeek")}}},buttonIcons:{prev:null,next:null},buttonText:{prev:"chevron_left",next:"chevron_right",today:"Today"},header:{left:"prev,next today",center:"title",right:"myMonth,myWeek,myMonthList,myWeekList"},eventLimit:!0,aspectRatio:1.6});$(".fc-myMonth-button").addClass("fc-state-active");var h=b.getParams();h.search?b.search=JSON.parse(h.search):b.resetSearch();b.initialSort=h.sort?JSON.parse(h.sort):
"Name";b.calendar=h.calendar?JSON.parse(h.calendar):{due:!0,parts:!0,tool:!0,dev:!0,ppap:!0,sample:!0};h.table&&(b.table=JSON.parse(h.table));b.board=JSON.parse(localStorage.getItem("board"));b.board?(b.filteredCards=b.board.cards,b.filter()):(console.log("cached copy not found"),b.getBoard())}]);
